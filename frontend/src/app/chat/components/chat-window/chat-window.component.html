<div class="chat-window">
  <!-- Header Section -->
  <div class="chat-header">
    <div class="breadcrumbs">
      <span class="channel-prefix">#</span>
      <span class="channel-name">{{currentChannel?.name || 'Select a channel'}}</span>
    </div>
    <div class="header-actions">
      <button class="action-btn" title="Search">
        <i class="fas fa-search"></i>
      </button>
      <button class="action-btn" title="More options">
        <i class="fas fa-ellipsis-v"></i>
      </button>
    </div>
  </div>

  <!-- Messages Section -->
  <div class="messages-container" #messagesContainer>
    <div class="empty-state" *ngIf="messages.length === 0">
      <i class="fas fa-comments"></i>
      <h3 class="gradient-text-blue">No messages yet âœ¨</h3>
      <p>Be the first one to send a message!</p>
    </div>
    
    <div class="messages-list" *ngIf="messages.length > 0">
      <div class="message" 
           *ngFor="let message of messages"
           (mouseenter)="onMessageMouseEnter(message.id)"
           (mouseleave)="onMessageMouseLeave()">
        <div class="message-avatar">
          <img [src]="getAvatarUrl(message)" [alt]="message.username">
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="username">
              <span class="status-dot" [class]="getUserStatus(message)"></span>
              <span class="anon-badge" *ngIf="message.anonymousId">
                <span class="anon-text">anon</span>
              </span>
              {{ message.user?.username || message.username }}
            </span>
            <span class="timestamp">{{ message.createdAt | date:'shortTime' }}</span>
            <div class="message-actions" [class.visible]="hoveredMessageId === message.id">
              <div class="reactions-container">
                <div class="existing-reactions" *ngIf="message.reactions?.length">
                  <ng-container *ngFor="let emoji of availableEmojis">
                    <button 
                      class="reaction-badge"
                      [class.active]="hasUserReacted(message, emoji)"
                      (click)="addReaction(message, emoji)"
                      *ngIf="getReactionCount(message, emoji) > 0">
                      {{ emoji }} {{ getReactionCount(message, emoji) }}
                    </button>
                  </ng-container>
                </div>

                <div class="reaction-button">
                  <button class="reaction-trigger" 
                          [class.visible]="hoveredMessageId === message.id"
                          (click)="$event.stopPropagation()">
                    <i class="far fa-face-smile"></i>
                  </button>
                  <div class="reaction-menu">
                    <button 
                      *ngFor="let emoji of availableEmojis"
                      class="emoji-button"
                      [class.active]="hasUserReacted(message, emoji)"
                      (click)="addReaction(message, emoji)">
                      {{ emoji }}
                    </button>
                  </div>
                </div>
    
                <div class="reply-count" *ngIf="message.replyCount" (click)="openThread(message)">
                  <i class="fas fa-reply"></i> {{ message.replyCount }}
                </div>
              </div>
            </div>
          </div>
          <div class="message-text">{{ message.content }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- New Messages Bar -->
  <div class="new-messages-bar" *ngIf="showNewMessageBar" (click)="jumpToNewMessages()">
    <i class="fas fa-arrow-down"></i>
    {{ unreadCount }} new message{{ unreadCount === 1 ? '' : 's' }}
  </div>

  <!-- Editor Section -->
  <div class="message-editor">
    <div class="editor-toolbar">
      <button class="toolbar-btn" (click)="openEmojiPicker()" title="Add emoji">
        <i class="far fa-smile"></i>
      </button>
      <button class="toolbar-btn" title="Upload file">
        <i class="fas fa-paperclip"></i>
      </button>
    </div>
    
    <div class="editor-input-wrapper">
      <textarea 
        class="message-input" 
        placeholder="Type a message..."
        [(ngModel)]="messageText"
        (keydown.enter)="onEnterPress($event)">
      </textarea>
      
      <button 
        class="send-button" 
        [disabled]="!messageText.trim()"
        (click)="sendMessage()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Thread Panel -->
  <div class="thread-panel" [class.open]="activeThread">
    <div class="thread-header">
      <div class="thread-title">Thread</div>
      <button class="close-thread" (click)="closeThread()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="thread-content" #threadContent>
      <div class="parent-message" *ngIf="activeThread">
        <div class="message-avatar">
          <img [src]="getAvatarUrl(activeThread)" [alt]="activeThread.username">
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="username">
              <span class="status-dot" [class]="getUserStatus(activeThread)"></span>
              <span class="anon-badge" *ngIf="activeThread.anonymousId">
                <span class="anon-text">anon</span>
              </span>
              {{ activeThread.user?.username || activeThread.username }}
            </span>
            <span class="timestamp">{{ activeThread.createdAt | date:'shortTime' }}</span>
          </div>
          <div class="message-text">{{ activeThread.content }}</div>
        </div>
      </div>
      <div class="thread-replies">
        <div class="message" *ngFor="let reply of threadReplies">
          <div class="message-avatar">
            <img [src]="getAvatarUrl(reply)" [alt]="reply.username">
          </div>
          <div class="message-content">
            <div class="message-header">
              <span class="username">
                <span class="status-dot" [class]="getUserStatus(reply)"></span>
                <span class="anon-badge" *ngIf="reply.anonymousId">
                  <span class="anon-text">anon</span>
                </span>
                {{ reply.user?.username || reply.username }}
              </span>
              <span class="timestamp">{{ reply.createdAt | date:'shortTime' }}</span>
            </div>
            <div class="message-text">{{ reply.content }}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="thread-editor">
      <textarea 
        class="reply-input" 
        placeholder="Reply in thread..."
        [(ngModel)]="threadReplyText"
        (keydown.enter)="onThreadReplyEnterPress($event)">
      </textarea>
      <button 
        class="send-button" 
        [disabled]="!threadReplyText.trim()"
        (click)="sendThreadReply()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div> 